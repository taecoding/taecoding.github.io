## 2020.01.G2.sol

<style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style>
<body data-gr-c-s-loaded="true" cz-shortcut-listen="true"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
(Analysis by Benjamin Qi)
<p>For each pair <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>i</mi><mo>,</mo><mi>k</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 1.986em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.866em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1001.81em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mo" id="MathJax-Span-3" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-4" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-5" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-6" style="font-family: STIXGeneral-Italic; padding-left: 0.183em;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-7" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>k</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">(i,k)</script></span> satisfying <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mo>&amp;lt;</mo><mi>k</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-8" style="width: 2.106em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.986em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1001.99em, 2.707em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-9"><span class="mi" id="MathJax-Span-10" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-11" style="font-family: STIXGeneral-Regular; padding-left: 0.303em;">&lt;</span><span class="mi" id="MathJax-Span-12" style="font-family: STIXGeneral-Italic; padding-left: 0.303em;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>&lt;</mo><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">i<k</script></span> let <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-13" style="width: 3.969em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.789em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1003.73em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-14"><span class="mi" id="MathJax-Span-15" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-16" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-17" style="font-family: STIXGeneral-Italic;">m</span><span class="mo" id="MathJax-Span-18" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-19" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-20" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-21" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-22" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">num[i][k]</script></span> equal the number of <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>j</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-24" style="width: 0.303em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.303em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1000.3em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-25"><span class="mi" id="MathJax-Span-26" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">j</script></span>
such that <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mo>&amp;lt;</mo><mi>j</mi><mo>&amp;lt;</mo><mi>k</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-27" style="width: 3.789em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.609em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1003.61em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-30" style="font-family: STIXGeneral-Regular; padding-left: 0.303em;">&lt;</span><span class="mi" id="MathJax-Span-31" style="font-family: STIXGeneral-Italic; padding-left: 0.303em;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-32" style="font-family: STIXGeneral-Regular; padding-left: 0.303em;">&lt;</span><span class="mi" id="MathJax-Span-33" style="font-family: STIXGeneral-Italic; padding-left: 0.303em;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>&lt;</mo><mi>j</mi><mo>&lt;</mo><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">i<j<k</script></span> and <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>A</mi><mi>i</mi></msub><mo>+</mo><msub><mi>A</mi><mi>j</mi></msub><mo>+</mo><msub><mi>A</mi><mi>k</mi></msub><mo>=</mo><mn>0</mn></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-34" style="width: 7.275em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.974em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1006.97em, 3.008em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-35"><span class="msubsup" id="MathJax-Span-36"><span style="display: inline-block; position: relative; width: 0.904em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-37" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="mi" id="MathJax-Span-38" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-39" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="msubsup" id="MathJax-Span-40" style="padding-left: 0.243em;"><span style="display: inline-block; position: relative; width: 0.904em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-41" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="mi" id="MathJax-Span-42" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-43" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="msubsup" id="MathJax-Span-44" style="padding-left: 0.243em;"><span style="display: inline-block; position: relative; width: 1.025em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-45" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="mi" id="MathJax-Span-46" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-47" style="font-family: STIXGeneral-Regular; padding-left: 0.303em;">=</span><span class="mn" id="MathJax-Span-48" style="font-family: STIXGeneral-Regular; padding-left: 0.303em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mi>i</mi></msub><mo>+</mo><msub><mi>A</mi><mi>j</mi></msub><mo>+</mo><msub><mi>A</mi><mi>k</mi></msub><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-6">A_i+A_j+A_k=0</script></span>. Then if <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 3.609em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.428em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1003.37em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="mi" id="MathJax-Span-51" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-52" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-53" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-54" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-55" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-56" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-57" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-58" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-59" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">ans[i][k]</script></span> denotes the answer
for  <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><msub><mi>A</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>&amp;#x2026;</mo><mo>,</mo><msub><mi>A</mi><mi>k</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-60" style="width: 7.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.794em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1006.73em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-61"><span class="mo" id="MathJax-Span-62" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-63"><span style="display: inline-block; position: relative; width: 0.904em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-64" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="mi" id="MathJax-Span-65" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-66" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-67" style="padding-left: 0.183em;"><span style="display: inline-block; position: relative; width: 1.746em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-68" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="texatom" id="MathJax-Span-69"><span class="mrow" id="MathJax-Span-70"><span class="mi" id="MathJax-Span-71" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-72" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">+</span><span class="mn" id="MathJax-Span-73" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-74" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-75" style="font-family: STIXGeneral-Regular; padding-left: 0.183em;">…</span><span class="mo" id="MathJax-Span-76" style="font-family: STIXGeneral-Regular; padding-left: 0.183em;">,</span><span class="msubsup" id="MathJax-Span-77" style="padding-left: 0.183em;"><span style="display: inline-block; position: relative; width: 1.025em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-78" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="mi" id="MathJax-Span-79" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-80" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><msub><mi>A</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>…</mo><mo>,</mo><msub><mi>A</mi><mi>k</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">(A_i,A_{i+1},\ldots,A_k)</script></span>, we can write
</p><div class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo stretchy=&quot;false&quot;>]</mo><mo>+</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo>+</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x2212;</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo>.</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-81" style="width: 30.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 29.33em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1029.27em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-82"><span class="mi" id="MathJax-Span-83" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-84" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-85" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-86" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-87" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-88" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-89" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-90" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-91" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-92" style="font-family: STIXGeneral-Regular; padding-left: 0.303em;">=</span><span class="mi" id="MathJax-Span-93" style="font-family: STIXGeneral-Italic; padding-left: 0.303em;">n</span><span class="mi" id="MathJax-Span-94" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-95" style="font-family: STIXGeneral-Italic;">m</span><span class="mo" id="MathJax-Span-96" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-97" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-98" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-99" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-100" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-101" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-102" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="mi" id="MathJax-Span-103" style="font-family: STIXGeneral-Italic; padding-left: 0.243em;">a</span><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-105" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-106" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-107" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-108" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-109" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-110" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-111" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">−</span><span class="mn" id="MathJax-Span-112" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">1</span><span class="mo" id="MathJax-Span-113" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-114" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="mi" id="MathJax-Span-115" style="font-family: STIXGeneral-Italic; padding-left: 0.243em;">a</span><span class="mi" id="MathJax-Span-116" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-117" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-118" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-119" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-120" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="mn" id="MathJax-Span-121" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">1</span><span class="mo" id="MathJax-Span-122" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-123" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-124" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-125" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-126" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">−</span><span class="mi" id="MathJax-Span-127" style="font-family: STIXGeneral-Italic; padding-left: 0.243em;">a</span><span class="mi" id="MathJax-Span-128" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-129" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-130" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-131" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-132" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="mn" id="MathJax-Span-133" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">1</span><span class="mo" id="MathJax-Span-134" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-135" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-136" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-137" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">−</span><span class="mn" id="MathJax-Span-138" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">1</span><span class="mo" id="MathJax-Span-139" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-140" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo>=</mo><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo>+</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo>−</mo><mi>a</mi><mi>n</mi><mi>s</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-9">ans[i][k]=num[i][k]+ans[i][k-1]+ans[i+1][k]-ans[i+1][k-1].</script></div>
After generating <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>a</mi><mi>n</mi><mi>s</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-141" style="width: 1.445em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.385em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.926em, 1001.38em, 2.707em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-142"><span class="mi" id="MathJax-Span-143" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-144" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-145" style="font-family: STIXGeneral-Italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>n</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">ans</script></span>, each query can be answered in constant time.
<p>Now I'll describe a way to compute <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><mo>&amp;#x2026;</mo><mo>,</mo><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>N</mi><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-146" style="width: 11.842em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.361em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1011.3em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-147"><span class="mi" id="MathJax-Span-148" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-149" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-150" style="font-family: STIXGeneral-Italic;">m</span><span class="mo" id="MathJax-Span-151" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-152" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-153" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-154" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-155" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-156" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="mn" id="MathJax-Span-157" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">1</span><span class="mo" id="MathJax-Span-158" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-159" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-160" style="font-family: STIXGeneral-Regular; padding-left: 0.183em;">…</span><span class="mo" id="MathJax-Span-161" style="font-family: STIXGeneral-Regular; padding-left: 0.183em;">,</span><span class="mi" id="MathJax-Span-162" style="font-family: STIXGeneral-Italic; padding-left: 0.183em;">n</span><span class="mi" id="MathJax-Span-163" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-164" style="font-family: STIXGeneral-Italic;">m</span><span class="mo" id="MathJax-Span-165" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-166" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-167" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-168" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-169" style="font-family: STIXGeneral-Italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-170" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>,</mo><mo>…</mo><mo>,</mo><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>N</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">num[i][i+1],\ldots, num[i][N]</script></span> in <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>N</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-171" style="width: 2.227em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.106em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1002.05em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-172"><span class="mi" id="MathJax-Span-173" style="font-family: STIXGeneral-Italic;">O</span><span class="mo" id="MathJax-Span-174" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-175" style="font-family: STIXGeneral-Italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span class="mo" id="MathJax-Span-176" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12">O(N)</script></span>
time. For each <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-177" style="width: 0.484em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.424em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1000.42em, 2.707em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-178"><span class="mi" id="MathJax-Span-179" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">k</script></span> from <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mo>+</mo><mn>1</mn><mo>,</mo><mo>&amp;#x2026;</mo><mi>N</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-180" style="width: 4.45em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.27em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1004.27em, 2.828em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-181"><span class="mi" id="MathJax-Span-182" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-183" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="mn" id="MathJax-Span-184" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">1</span><span class="mo" id="MathJax-Span-185" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-186" style="font-family: STIXGeneral-Regular; padding-left: 0.183em;">…</span><span class="mi" id="MathJax-Span-187" style="font-family: STIXGeneral-Italic; padding-left: 0.183em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>+</mo><mn>1</mn><mo>,</mo><mo>…</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">i+1,\ldots N</script></span> in increasing order, consider a hashmap
(unordered_map in C++) that allows you to query the number of occurrences of any
integer among <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>A</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>&amp;#x2026;</mo><mo>,</mo><msub><mi>A</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>k</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-188" style="width: 5.892em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.652em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1005.65em, 2.948em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-189"><span class="msubsup" id="MathJax-Span-190"><span style="display: inline-block; position: relative; width: 1.746em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-191" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="texatom" id="MathJax-Span-192"><span class="mrow" id="MathJax-Span-193"><span class="mi" id="MathJax-Span-194" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-195" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">+</span><span class="mn" id="MathJax-Span-196" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-197" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-198" style="font-family: STIXGeneral-Regular; padding-left: 0.183em;">…</span><span class="mo" id="MathJax-Span-199" style="font-family: STIXGeneral-Regular; padding-left: 0.183em;">,</span><span class="msubsup" id="MathJax-Span-200" style="padding-left: 0.183em;"><span style="display: inline-block; position: relative; width: 1.866em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-201" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="texatom" id="MathJax-Span-202"><span class="mrow" id="MathJax-Span-203"><span class="mi" id="MathJax-Span-204" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-205" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-206" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>…</mo><mo>,</mo><msub><mi>A</mi><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-15">A_{i+1},\ldots,A_{k-1}</script></span>. Then <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>[</mo><mi>k</mi><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-207" style="width: 3.969em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.789em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1003.73em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-208"><span class="mi" id="MathJax-Span-209" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-210" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-211" style="font-family: STIXGeneral-Italic;">m</span><span class="mo" id="MathJax-Span-212" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-213" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-214" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-215" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-216" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-217" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-16">num[i][k]</script></span> is equal to the number
of occurrences of <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2212;</mo><msub><mi>A</mi><mi>i</mi></msub><mo>&amp;#x2212;</mo><msub><mi>A</mi><mi>k</mi></msub></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-218" style="width: 3.969em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.789em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1003.79em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-219"><span class="mo" id="MathJax-Span-220" style="font-family: STIXGeneral-Regular;">−</span><span class="msubsup" id="MathJax-Span-221"><span style="display: inline-block; position: relative; width: 0.904em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-222" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="mi" id="MathJax-Span-223" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-224" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">−</span><span class="msubsup" id="MathJax-Span-225" style="padding-left: 0.243em;"><span style="display: inline-block; position: relative; width: 1.025em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.54em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-226" style="font-family: STIXGeneral-Italic;">A</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -3.903em; left: 0.604em;"><span class="mi" id="MathJax-Span-227" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><msub><mi>A</mi><mi>i</mi></msub><mo>−</mo><msub><mi>A</mi><mi>k</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-17">-A_i-A_k</script></span> in this map. When <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-228" style="width: 0.484em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.424em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1000.42em, 2.707em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-229"><span class="mi" id="MathJax-Span-230" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">k</script></span> is incremented by one the
only change to the map is a single insertion. As hashmap operations run in
<span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-231" style="width: 1.986em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.866em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1001.81em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-232"><span class="mi" id="MathJax-Span-233" style="font-family: STIXGeneral-Italic;">O</span><span class="mo" id="MathJax-Span-234" style="font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-235" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-236" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">O(1)</script></span> time, this solution runs in <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-237" style="width: 2.707em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.587em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.505em, 1002.53em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-238"><span class="mi" id="MathJax-Span-239" style="font-family: STIXGeneral-Italic;">O</span><span class="mo" id="MathJax-Span-240" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-241"><span style="display: inline-block; position: relative; width: 1.205em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.72em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mi" id="MathJax-Span-242" style="font-family: STIXGeneral-Italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.063em;"></span></span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -4.384em; left: 0.784em;"><span class="mn" id="MathJax-Span-243" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-244" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-20">O(N^2)</script></span> time overall.
</p><p>However, due to the high constant factor of hashmap, this solution does not earn
full points. Because all entries of <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>A</mi></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-245" style="width: 0.664em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.604em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.686em, 1000.54em, 2.707em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-246"><span class="mi" id="MathJax-Span-247" style="font-family: STIXGeneral-Italic;">A</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.816em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">A</script></span> are in the range <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><msup><mn>10</mn><mn>6</mn></msup><mo>,</mo><msup><mn>10</mn><mn>6</mn></msup><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-248" style="width: 5.171em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.931em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.445em, 1004.87em, 2.888em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-249"><span class="mo" id="MathJax-Span-250" style="font-family: STIXGeneral-Regular;">[</span><span class="mo" id="MathJax-Span-251" style="font-family: STIXGeneral-Regular;">−</span><span class="msubsup" id="MathJax-Span-252"><span style="display: inline-block; position: relative; width: 1.445em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.97em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mn" id="MathJax-Span-253" style="font-family: STIXGeneral-Regular;">10</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -4.444em; left: 1.025em;"><span class="mn" id="MathJax-Span-254" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">6</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-255" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-256" style="padding-left: 0.183em;"><span style="display: inline-block; position: relative; width: 1.445em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.97em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mn" id="MathJax-Span-257" style="font-family: STIXGeneral-Regular;">10</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -4.444em; left: 1.025em;"><span class="mn" id="MathJax-Span-258" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">6</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-259" style="font-family: STIXGeneral-Regular;">]</span><span class="mo" id="MathJax-Span-260" style="font-family: STIXGeneral-Regular;">,</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><msup><mn>10</mn><mn>6</mn></msup><mo>,</mo><msup><mn>10</mn><mn>6</mn></msup><mo stretchy="false">]</mo><mo>,</mo></math></span></span><script type="math/tex" id="MathJax-Element-22">[-10^6,10^6],</script></span> we can
replace the hashmap with an array of size <span class="math"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mo>&amp;#x22C5;</mo><msup><mn>10</mn><mn>6</mn></msup><mo>+</mo><mn>1</mn><mo>,</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-261" style="width: 4.811em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.63em; height: 0px; font-size: 104%;"><span style="position: absolute; clip: rect(1.445em, 1004.57em, 2.828em, -999.997em); top: -2.521em; left: 0em;"><span class="mrow" id="MathJax-Span-262"><span class="mn" id="MathJax-Span-263" style="font-family: STIXGeneral-Regular;">2</span><span class="mo" id="MathJax-Span-264" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">⋅</span><span class="msubsup" id="MathJax-Span-265" style="padding-left: 0.243em;"><span style="display: inline-block; position: relative; width: 1.445em; height: 0px;"><span style="position: absolute; clip: rect(3.188em, 1000.97em, 4.21em, -999.997em); top: -4.023em; left: 0em;"><span class="mn" id="MathJax-Span-266" style="font-family: STIXGeneral-Regular;">10</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span><span style="position: absolute; top: -4.444em; left: 1.025em;"><span class="mn" id="MathJax-Span-267" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">6</span><span style="display: inline-block; width: 0px; height: 4.029em;"></span></span></span></span><span class="mo" id="MathJax-Span-268" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">+</span><span class="mn" id="MathJax-Span-269" style="font-family: STIXGeneral-Regular; padding-left: 0.243em;">1</span><span class="mo" id="MathJax-Span-270" style="font-family: STIXGeneral-Regular;">,</span></span><span style="display: inline-block; width: 0px; height: 2.527em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>⋅</mo><msup><mn>10</mn><mn>6</mn></msup><mo>+</mo><mn>1</mn><mo>,</mo></math></span></span><script type="math/tex" id="MathJax-Element-23">2\cdot 10^6+1,</script></span> greatly improving the
runtime.
</p><p></p><pre class="prettyprint">import java.io.*;
import java.util.*;
 
public class threesum {
	public static void main(String[] args) throws IOException {
		BufferedReader in = new BufferedReader(new FileReader("threesum.in"));
		PrintWriter out = new PrintWriter(new BufferedWriter(new FileWriter("threesum.out")));
		String[] line = in.readLine().split(" ");
		int N = Integer.parseInt(line[0]);
		int Q = Integer.parseInt(line[1]);
		line = in.readLine().split(" ");
		int[] A = new int[N]; 
		long[][] ans = new long[N][N];
		for (int i = 0; i &lt; N; ++i) A[i] = Integer.parseInt(line[i]);
		int[] z = new int[2000001];
		for (int i = N-1; i &gt;= 0; --i) {
			for (int j = i+1; j &lt; N; ++j) {
				int ind = 1000000-A[i]-A[j];
				if (ind &gt;= 0 &amp;&amp; ind &lt;= 2000000) ans[i][j] = z[ind];
				z[1000000+A[j]] ++;
			}
			for (int j = i+1; j &lt; N; ++j) {
				z[1000000+A[j]] --;
			}
		}
		for (int i = N-1; i &gt;= 0; --i) 
			for (int j = i+1; j &lt; N; ++j)
				ans[i][j] += ans[i+1][j]+ans[i][j-1]-ans[i+1][j-1];
		for (int i = 0; i &lt; Q; ++i) {
			line = in.readLine().split(" ");
			int a = Integer.parseInt(line[0]);
			int b = Integer.parseInt(line[1]);
			out.println(ans[a-1][b-1]);
		}
		out.close();
	}
}
</pre>
<p>Of course, it was still possible to pass without replacing the hashmap by an
array. Although this wasn't intended, I'll include two additional solutions for
the sake of completeness. 
</p><p>In C++, gp_hash_table is somewhat faster than unordered_map, especially if you
specify an initial capacity. See
<a href="https://codeforces.com/blog/entry/60737">here</a> for more information.
</p><p></p><pre class="prettyprint">#include &lt;bits/stdc++.h&gt;
using namespace std;

void setIO(string name) {
    ios_base::sync_with_stdio(0); cin.tie(0);
    freopen((name+".in").c_str(),"r",stdin);
    freopen((name+".out").c_str(),"w",stdout);
}

#include &lt;ext/pb_ds/assoc_container.hpp&gt; // for gp_hash_table
using namespace __gnu_pbds;

int N,Q;
long long ans[5000][5000];
vector&lt;int&gt; A;
 
int main() {
	setIO("threesum");
	cin &gt;&gt; N &gt;&gt; Q;
	A.resize(N); for (int i = 0; i &lt; N; ++i) cin &gt;&gt; A[i];
	for (int i = 0; i &lt; N; ++i) {
		gp_hash_table&lt;int,int&gt; g({},{},{},{},{1&lt;&lt;13}); 
		// initialize with capacity that is a power of 2
		for (int j = i+1; j &lt; N; ++j) {
			int res = -A[i]-A[j];
			auto it = g.find(res); 
			if (it != end(g)) ans[i][j] = it-&gt;second;
			g[A[j]] ++;
		}
	}
	for (int i = N-1; i &gt;= 0; --i) for (int j = i+1; j &lt; N; ++j)
		ans[i][j] += ans[i+1][j]+ans[i][j-1]-ans[i+1][j-1];
	for (int i = 0; i &lt; Q; ++i) {
		int a,b; cin &gt;&gt; a &gt;&gt; b;
		cout &lt;&lt; ans[a-1][b-1] &lt;&lt; "\n";
	}
}
</pre>
<p>In Java, a hashmap solution passes if StreamTokenizer is used to take care of input, although it uses much more memory
than I would expect. (If anyone knows how to reduce the memory usage, could you
let me know?)
</p><p></p><pre class="prettyprint">import java.io.*;
import java.util.*;
 
public class threesum {
	static StreamTokenizer in;
	static int nextInt() throws IOException {
		in.nextToken();
		return (int)in.nval;
	}
	public static void main(String[] args) throws IOException {
		in = new StreamTokenizer(new BufferedReader(new FileReader("threesum.in")));
		PrintWriter out = new PrintWriter(new BufferedWriter(new FileWriter("threesum.out")));
		int N = nextInt(); int Q = nextInt();
		int[] A = new int[N]; 
		long[][] ans = new long[N][N];
		for (int i = 0; i &lt; N; ++i) A[i] = nextInt();
		Map&lt;Integer,Integer&gt; z = new HashMap&lt;&gt;();
		for (int i = N-1; i &gt;= 0; --i) {
			z.clear();
			for (int j = i+1; j &lt; N; ++j) {
				int ind = -A[i]-A[j];
				ans[i][j] = z.getOrDefault(ind,0);
				z.put(A[j],z.getOrDefault(A[j],0)+1);
			}
		}
		for (int i = N-1; i &gt;= 0; --i) 
			for (int j = i+1; j &lt; N; ++j)
				ans[i][j] += ans[i+1][j]+ans[i][j-1]-ans[i+1][j-1];
		for (int i = 0; i &lt; Q; ++i) 
			out.println(ans[nextInt()-1][nextInt()-1]);
		out.close();
	}
}
</pre>
<p>
</p><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: STIXSizeOneSym, sans-serif;"></div></div></body>