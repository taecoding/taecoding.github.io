
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Gold 2 solution Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="2019.12.G3.sol.html" />
    
    
    <link rel="prev" href="2019.12.G1.sol.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    [2019]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    [December-Bronze]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="2019.12.B1.html">
            
                <a href="2019.12.B1.html">
            
                    
                    Bronze 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="2019.12.B2.html">
            
                <a href="2019.12.B2.html">
            
                    
                    Bronze 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="2019.12.B3.html">
            
                <a href="2019.12.B3.html">
            
                    
                    Bronze 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="2019.12.B1.sol.md">
            
                <span>
            
                    
                    Bronze 1 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="2019.12.B2.sol.md">
            
                <span>
            
                    
                    Bronze 2 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.6" data-path="2019.12.B3.sol.md">
            
                <span>
            
                    
                    Bronze 3 solution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    [December-Bilver]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="2019.12.S1.html">
            
                <a href="2019.12.S1.html">
            
                    
                    Silver 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="2019.12.S2.html">
            
                <a href="2019.12.S2.html">
            
                    
                    Silver 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="2019.12.S3.html">
            
                <a href="2019.12.S3.html">
            
                    
                    Silver 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="2019.12.S1.sol.html">
            
                <a href="2019.12.S1.sol.html">
            
                    
                    Silver 1 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="2019.12.S2.sol.html">
            
                <a href="2019.12.S2.sol.html">
            
                    
                    Silver 2 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="2019.12.S3.sol.html">
            
                <a href="2019.12.S3.sol.html">
            
                    
                    Silver 3 solution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" >
            
                <span>
            
                    
                    [December-Gold]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="2019.12.G1.html">
            
                <a href="2019.12.G1.html">
            
                    
                    Gold 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="2019.12.G2.html">
            
                <a href="2019.12.G2.html">
            
                    
                    Gold 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="2019.12.G3.html">
            
                <a href="2019.12.G3.html">
            
                    
                    Gold 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="2019.12.G1.sol.html">
            
                <a href="2019.12.G1.sol.html">
            
                    
                    Gold 1 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.3.5" data-path="2019.12.G2.sol.html">
            
                <a href="2019.12.G2.sol.html">
            
                    
                    Gold 2 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="2019.12.G3.sol.html">
            
                <a href="2019.12.G3.sol.html">
            
                    
                    Gold 3 solution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    [2020]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    [December-Silver]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../2020.01/2020.01.S1.html">
            
                <a href="../2020.01/2020.01.S1.html">
            
                    
                    Silver 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../2020.01/2020.01.S2.html">
            
                <a href="../2020.01/2020.01.S2.html">
            
                    
                    Silver 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../2020.01/2020.01.S3.html">
            
                <a href="../2020.01/2020.01.S3.html">
            
                    
                    Silver 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../2020.01/2020.01.S1.sol.html">
            
                <a href="../2020.01/2020.01.S1.sol.html">
            
                    
                    Silver 1 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../2020.01/2020.01.S2.sol.html">
            
                <a href="../2020.01/2020.01.S2.sol.html">
            
                    
                    Silver 2 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="../2020.01/2020.01.S3.sol.html">
            
                <a href="../2020.01/2020.01.S3.sol.html">
            
                    
                    Silver 3 solution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    [December-Gold]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../2020.01/2020.01.G1.html">
            
                <a href="../2020.01/2020.01.G1.html">
            
                    
                    Gold 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../2020.01/2020.01.G2.html">
            
                <a href="../2020.01/2020.01.G2.html">
            
                    
                    Gold 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../2020.01/2020.01.G3.html">
            
                <a href="../2020.01/2020.01.G3.html">
            
                    
                    Gold 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../2020.01/2020.01.G1.sol.html">
            
                <a href="../2020.01/2020.01.G1.sol.html">
            
                    
                    Gold 1 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="../2020.01/2020.01.G2.sol.html">
            
                <a href="../2020.01/2020.01.G2.sol.html">
            
                    
                    Gold 2 solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="../2020.01/2020.01.G3.sol.html">
            
                <a href="../2020.01/2020.01.G3.sol.html">
            
                    
                    Gold 3 solution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Gold 2 solution</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>(Analysis by Benjamin Qi)
We can answer the queries offline (meaning that we process them in an order that is convenient for us, not that which is given by the input). Like the silver version, run a DFS from farm 1. Suppose that we&apos;re currently processing the farm x. Store a stack ord containing all the nodes on the path from 1 to x, and also a stack stor[t] for each type t containing the pairs (y,depth[y]) for all farms y with type t on the path from 1 to x.</p>
<p>Suppose that we want to update the answer for a query i having an endpoint Ai=x (the reasoning for Bi=x is similar). We need to check whether the last farm y in the stack corresponding to Ci actually lies on the path from Ai to Bi. Let L be the least common ancestor of Ai and Bi. First, we can check whether y is an ancestor of Bi in O(1) using the preorder and postorder traversals of the tree. If not, then y lies on the path between Ai and Li, so the answer to this query must be 1. If yes, then it&apos;s still possible for y to lie on the path from Ai to Bi if y=Li.</p>
<p>One option is to actually find Li and compare it to y, but this is unnecessary. Instead, if y&#x2260;Ai then consider the farm Y=ord[depth[y]+1]. If Y is an ancestor of Bi, then y is clearly not the LCA. Otherwise, Ai and Bi lie in different child subtrees of y, implying that y is the LCA.</p>
<p>Thus, this problem is solvable in O(N+M) time.</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt; pi;
<span class="hljs-keyword">typedef</span> <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; vi;
<span class="hljs-keyword">typedef</span> <span class="hljs-built_in">vector</span>&lt;pi&gt; vpi;

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FOR(i, a, b) for (int i = (a); i &lt; (b); i++)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F0R(i, a) for (int i = 0; i &lt; (a); i++)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FORd(i,a,b) for (int i = (b)-1; i &gt;= (a); i--)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F0Rd(i,a) for (int i = (a)-1; i &gt;= 0; i--)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> trav(a, x) for (auto&amp; a : x)</span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> mp make_pair</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> pb push_back</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> f first</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> s second</span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> sz(x) (int)x.size()</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> all(x) begin(x), end(x)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> rsz resize</span>

<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MX = <span class="hljs-number">100005</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setIO</span><span class="hljs-params">(<span class="hljs-built_in">string</span> name)</span> </span>{
    ios_base::sync_with_stdio(<span class="hljs-number">0</span>); <span class="hljs-built_in">cin</span>.tie(<span class="hljs-number">0</span>);
    freopen((name+<span class="hljs-string">&quot;.in&quot;</span>).c_str(),<span class="hljs-string">&quot;r&quot;</span>,<span class="hljs-built_in">stdin</span>);
    freopen((name+<span class="hljs-string">&quot;.out&quot;</span>).c_str(),<span class="hljs-string">&quot;w&quot;</span>,<span class="hljs-built_in">stdout</span>);
}

<span class="hljs-keyword">int</span> N,M,T[MX],C[MX];
<span class="hljs-keyword">bool</span> ok[MX];
vi adj[MX];
<span class="hljs-built_in">array</span>&lt;<span class="hljs-keyword">int</span>,2&gt; dat[MX];
vi todo[MX];
pi range[MX];

<span class="hljs-keyword">int</span> co = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{
    range[x].f = co++;
    trav(t,adj[x]) <span class="hljs-keyword">if</span> (t != y) dfs(t,x);
    range[x].s = co<span class="hljs-number">-1</span>;
}

vpi stor[MX];
vi ord;

<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">anc</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>{
    <span class="hljs-keyword">return</span> range[a].f &lt;= range[b].f &amp;&amp; range[b].s &lt;= range[a].s;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{
    stor[T[x]].pb({x,sz(ord)}); ord.pb(x);
    trav(t,todo[x]) <span class="hljs-keyword">if</span> (sz(stor[C[t]])) {
        pi y = stor[C[t]].back();
        <span class="hljs-keyword">if</span> (y.f == x) ok[t] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">int</span> Y = ord[y.s+<span class="hljs-number">1</span>];
            <span class="hljs-comment">// x is one of endpoints for query t</span>
            assert(dat[t][<span class="hljs-number">0</span>] == x || dat[t][<span class="hljs-number">1</span>] == x); 
            <span class="hljs-keyword">if</span> (!anc(Y,dat[t][<span class="hljs-number">0</span>]+dat[t][<span class="hljs-number">1</span>]-x)) ok[t] = <span class="hljs-number">1</span>;
        }
    }
    trav(t,adj[x]) <span class="hljs-keyword">if</span> (t != y) dfs2(t,x);
    stor[T[x]].pop_back(); ord.pop_back();
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    setIO(<span class="hljs-string">&quot;milkvisits&quot;</span>); 
    <span class="hljs-built_in">cin</span> &gt;&gt; N &gt;&gt; M;
    FOR(i,<span class="hljs-number">1</span>,N+<span class="hljs-number">1</span>) <span class="hljs-built_in">cin</span> &gt;&gt; T[i];
    F0R(i,N<span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">int</span> A,B; <span class="hljs-built_in">cin</span> &gt;&gt; A &gt;&gt; B;
        adj[A].pb(B), adj[B].pb(A);
    }
    dfs(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
    F0R(i,M) {
        <span class="hljs-built_in">cin</span> &gt;&gt; dat[i][<span class="hljs-number">0</span>] &gt;&gt; dat[i][<span class="hljs-number">1</span>] &gt;&gt; C[i];
        F0R(j,<span class="hljs-number">2</span>) todo[dat[i][j]].pb(i);
    }
    dfs2(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
    F0R(i,M) {
        <span class="hljs-keyword">if</span> (ok[i]) <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-number">0</span>;
    }
    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;
}
</code></pre>
<p>Bonus: solve the problem online in O((N+M)logN).</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="2019.12.G1.sol.html" class="navigation navigation-prev " aria-label="Previous page: Gold 1 solution">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="2019.12.G3.sol.html" class="navigation navigation-next " aria-label="Next page: Gold 3 solution">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Gold 2 solution","level":"1.2.3.5","depth":3,"next":{"title":"Gold 3 solution","level":"1.2.3.6","depth":3,"path":"2019.12/2019.12.G3.sol.md","ref":"2019.12/2019.12.G3.sol.md","articles":[]},"previous":{"title":"Gold 1 solution","level":"1.2.3.4","depth":3,"path":"2019.12/2019.12.G1.sol.md","ref":"2019.12/2019.12.G1.sol.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["collapsible-chapters"],"pluginsConfig":{"collapsible-chapters":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"2019.12/2019.12.G2.sol.md","mtime":"2020-02-23T13:19:19.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-03-28T13:38:45.207Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

